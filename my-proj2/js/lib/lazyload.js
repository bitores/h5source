"use strict";(function(){var lazyload=angular.module("lazyload",[]);lazyload.directive("lazyload",["$document","$window",function(document,window){var $=function(ele){return angular.element(ele)};var elements=(function(){var _uid=0;var _list=[];return{push:function(ele){_list[_uid++]=ele},del:function(key){_list[key]&&delete _list[key]},get:function(){return _list},size:function(){return _list.length}}})();var isVisible=function(ele){var rect=ele[0].getBoundingClientRect();rect.offsetTop=ele[0].offsetTop;if($(window)[0].parent.innerHeight<rect.offsetTop&&$(window)[0].pageYOffset+$(window)[0].parent.innerHeight<rect.offsetTop||$(window)[0].pageYOffset>(rect.offsetTop+rect.height)){return false}else{return true}};var checkImage=function(){var eles=elements.get();angular.forEach(eles,function(v,k){isVisible(v.elem)?eles[k].load(k):false})};var initLazyload=function(){checkImage();$(window).on("scroll",checkImage)};return{restrict:"EA",scope:{watch:"="},link:function(scope,ele,attrs){ele.css({"opacity":1,"transition":"opacity 1s","-webkit-transition":"opacity 1s","animation-duration":"1s"});elements.push({elem:ele,load:function(key){ele.attr("src",attrs["lazyload"]);ele.on("load",function(){ele.css({"opacity":"1"})});ele.on("error",function(){ele.attr("src",attrs["origin"])});if(key>=0){elements.del(key)}}});initLazyload()}}}])})();