!function(){"use strict";angular.module("crmApp",["ngCookies","ngResource","ngSanitize","ngRoute","route-segment","view-segment","ui.bootstrap","angularFileUpload"]).config(["$routeProvider","$routeSegmentProvider","$httpProvider",function($routeProvider,$routeSegmentProvider,$httpProvider){$httpProvider.defaults.timeout=500,delete $httpProvider.defaults.headers.common["X-Requested-With"],$httpProvider.defaults.useXDomain=!0,$routeSegmentProvider.options.autoLoadTemplates=!0,$routeSegmentProvider.when("/login","login").when("/main","main").when("/manage","manage.list").when("/mycustom","mycustom.list").when("/addcustom","custom.add").when("/unimport","custom.unimport").when("/importcustom","custom.import").when("/customdetail/:customerid","custom.detail").when("/book","book.step1").when("/bookstep1","book.step1").when("/bookstep2/:mealId","book.step2").when("/bookstep3/:bookid/:booktype","book.step3").when("/bookok","book.bookok").when("/bookfail","book.bookfail").when("/order","order").when("/ordermanage/:groupId","order.manage").when("/orderdetail/:ordernum","order.detail").when("/orderlist/:batchId","order.list").when("/ordersummrise","order.summrise").when("/ordermanage","order.ordermanage").when("/asset","asset.list").when("/charge","asset.charge").when("/alipay","asset.alipay").when("/alipayok","asset.alipayok").when("/alipayfail","asset.alipayfail").when("/inoutdetail","asset.detail").when("/distributerecord","asset.distribute").when("/deposit","asset.deposit").when("/proxyrecharge/:cardnum","asset.proxyrecharge.floatlayer").when("/account","account.info").when("/modifyaccount","account.modify").when("/changepass","account.pass").segment("main",{"default":!0,templateUrl:"views/main.html",controller:"MainCtrl"}).segment("login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).segment("manage",{templateUrl:"views/manage/manage.html",controller:"ManageCtrl"}).within().segment("list",{templateUrl:"views/manage/managelist.html"}).up().segment("mycustom",{templateUrl:"views/custom/custom1.html",controller:"CustomCtrl"}).within().segment("list",{templateUrl:"views/custom/customlist.html"}).up().segment("custom",{templateUrl:"views/custom/custom.html",controller:"CustomCtrl"}).within().segment("unimport",{templateUrl:"views/custom/unimport.html"}).segment("add",{templateUrl:"views/custom/addcustom.html"}).segment("import",{templateUrl:"views/custom/importcustom.html"}).segment("detail",{templateUrl:"views/custom/customdetail.html",dependencies:["customerid"]}).up().segment("book",{templateUrl:"views/book/book.html",controller:"BookCtrl"}).within().segment("step1",{templateUrl:"views/book/book_step1.html"}).segment("step2",{templateUrl:"views/book/book_step2.html",dependencies:["mealId"]}).segment("step3",{templateUrl:"views/book/book_step3.html",dependencies:["bookid","booktype"]}).segment("bookok",{templateUrl:"views/book/book_payok.html"}).segment("bookfail",{templateUrl:"views/book/book_payfail.html"}).up().segment("order",{templateUrl:"views/order/order.html",controller:"OrderCtrl"}).within().segment("manage",{templateUrl:"views/order/ordermanage.html",dependencies:["groupId"]}).segment("list",{templateUrl:"views/order/orderlist.html",dependencies:["batchId"]}).segment("detail",{templateUrl:"views/order/orderdetail.html",dependencies:["ordernum"]}).segment("summrise",{templateUrl:"views/order/ordersummrise.html"}).segment("ordermanage",{templateUrl:"views/order/ordermanage.html"}).up().segment("asset",{templateUrl:"views/asset/asset.html",controller:"AssetCtrl"}).within().segment("list",{templateUrl:"views/asset/assetlist.html"}).segment("alipay",{templateUrl:"views/asset/alipay.html"}).segment("alipayok",{templateUrl:"views/asset/alipayok.html"}).segment("alipayfail",{templateUrl:"views/asset/alipayfail.html"}).segment("charge",{templateUrl:"views/asset/charge.html"}).segment("detail",{templateUrl:"views/asset/inoutdetail.html"}).segment("distribute",{templateUrl:"views/asset/distributerecord.html"}).segment("deposit",{templateUrl:"views/asset/deposit.html"}).segment("proxyrecharge",{templateUrl:"views/asset/proxyrecharge.html",dependencies:["cardnum"]}).within().segment("floatlayer",{templateUrl:"views/asset/asset_floatlayer.html"}).up().up().segment("account",{templateUrl:"views/account/account.html",controller:"AccountCtrl"}).within().segment("info",{templateUrl:"views/account/accountinfo.html"}).segment("modify",{templateUrl:"views/account/modifyaccount.html"}).segment("pass",{templateUrl:"views/account/changepass.html"}),$routeProvider.otherwise({redirectTo:"/main"}),$httpProvider.responseInterceptors.push(["$q","$rootScope",function($q,$rootScope){var setMessage=function(response){response.data.text&&response.data.type&&($rootScope.message={text:response.data.text,type:response.data.type,show:!0})};return function(promise){return promise.then(function(response){return setMessage(response),response},function(response){return setMessage(response),$q.reject(response)})}}])}]),angular.module("crmApp").filter("routeSegmentStartsWith",["$routeSegment",function($routeSegment){return function(segment){return $routeSegment.startsWith(segment)}}]),angular.module("crmApp").filter("worknameFilter",function(){return function(workName,lastCompany){return lastCompany?lastCompany:workName}}),angular.module("crmApp").filter("mobileMergeIdCardFilter",function(){return function(mobile,idCard){return mobile&&idCard?mobile+"/"+idCard:mobile?mobile:idCard?idCard:""}}),angular.module("crmApp").filter("gender",["$routeSegment",function($routeSegment){return function(gender){return 0===gender||"0"===gender?"男":"女"}}]),angular.module("crmApp").filter("marry",function(){return function(married){return null==married||void 0==married?"":0===married||"0"===married?"未婚":1===married||"1"===married?"已婚":married}}),angular.module("crmApp").filter("parseInt",function(){return function(numberStr){return parseInt(numberStr)}}),angular.module("crmApp").filter("getBookDetail",function(){return function(bookDetail,keyWord){var detail=eval("("+bookDetail+")");return"meal"===keyWord?detail[keyWord][0].name:detail[keyWord]}}),angular.module("crmApp").filter("showImportAge",function(){return function(age,customer){return customer.idcard?customer.age:customer.importAge}}),angular.module("crmApp").filter("mergeLastBook",function($filter){return function(lastBookTime,lastBookMoney){return lastBookTime?$filter("date")(lastBookTime,"yyyy-MM-dd")+"/"+$filter("currency")(lastBookMoney/100,"¥"):""}}),angular.module("crmApp").filter("dateWeek",function($filter){return function(date,formatStr){return $filter("date")(date,formatStr)+" 星期"+"日一二三四五六".charAt(new Date(date).getDay())}}),angular.module("crmApp").directive("focus",function(){return{link:function(scope,element,attrs){element[0].focus()}}}),angular.module("crmApp").filter("index",function(){return function(array){return(array||[]).map(function(item,index){return item.order=index+1,item})}}),angular.module("crmApp").run(["$rootScope","$location","$window","Login",function($rootScope,$location,$window,Login){$rootScope.openHosLastAmount=function(){var url=$window.actionContextPath+"/hosLastStatistic/null/null";$(".toHosLastAmount").attr("href",url)},$rootScope.logout=function(){Login.logout()},$rootScope.$watch("isLogin",function(){var terval;1==$rootScope.isLogin?($.ajax({type:"get",url:"/crm/action/orderPaymentStatus",dataType:"json",complete:function(data){},success:function(data){var number=0,html='<i class="triangle_top_white"></i><ul>',grouids=[{groupId:0,paymentStatus:0}];0==data.length&&(html+='<li class="list-info">                                    <p class="color666">没有最新消息</p>                                </li>');for(var x in data){var type=0,ten=0;for(var i in grouids)grouids[i].groupId!=data[x].groupId?type=1:grouids[i].paymentStatus=data[x].paymentStatus,grouids[i].groupId==data[x].groupId&&(ten=1);if(type=0==ten){var list={groupId:data[x].groupId,paymentStatus:data[x].paymentStatus,time:data[x].time};grouids.push(list)}}grouids.shift();for(var k in grouids){var number=number+1,d=new Date;d.setTime(grouids[k].time);var s=d.toLocaleString();$(".bgcolorange").html(number),$(".bgcolorange").show(),4!=grouids[k].paymentStatus&&0!=grouids[k].paymentStatus||(html+='<li class="list-info">                                            <p class="color999">'+s+'</p>                                            <p class="color666">提交1个订单<span class="payin">支付中</span></p>                                        </li>'),1==grouids[k].paymentStatus&&(html+='<li class="list-info">                                            <p class="color999">'+s+'</p>                                            <p class="color666">提交1个订单<span class="payoks">支付成功</span></p>                                        </li>'),2==grouids[k].paymentStatus&&(html+='<li class="list-info">                                            <p class="color999">'+s+'</p>                                            <p class="color666">提交1个订单<span class="payout">支付失败</span></p>                                        </li>')}html+="</ul>",0==number&&$(".bgcolorange").hide(),$(".head .message .list").html(html)},error:function(data){}}),terval=setInterval(function(){$.ajax({type:"get",url:"/crm-web/action/orderPaymentStatus",dataType:"json",complete:function(data){},success:function(data){var number=0,html='<i class="triangle_top_white"></i><ul>',grouids=[{groupId:0,paymentStatus:0}];for(var x in data){var type=0,ten=0;for(var i in grouids)grouids[i].groupId!=data[x].groupId?type=1:grouids[i].paymentStatus=data[x].paymentStatus,grouids[i].groupId==data[x].groupId&&(ten=1);if(type=0==ten){var list={groupId:data[x].groupId,paymentStatus:data[x].paymentStatus,time:data[x].time};grouids.push(list)}}grouids.shift();for(var k in grouids){var number=number+1,d=new Date;d.setTime(grouids[k].time);var s=d.toLocaleString();$(".bgcolorange").html(number),$(".bgcolorange").show(),0==grouids.length&&(html+='<li class="list-info">                                            <p class="color666">没有最新消息</p>                                        </li>'),4!=grouids[k].paymentStatus&&0!=grouids[k].paymentStatus||(html+='<li class="list-info">                                            <p class="color999">'+s+'</p>                                            <p class="color666">提交1个订单<span class="payin">支付中</span></p>                                        </li>'),1==grouids[k].paymentStatus&&(html+='<li class="list-info">                                            <p class="color999">'+s+'</p>                                            <p class="color666">提交1个订单<span class="payoks">支付成功</span></p>                                        </li>'),2==grouids[k].paymentStatus&&(html+='<li class="list-info">                                            <p class="color999">'+s+'</p>                                            <p class="color666">提交1个订单<span class="payout">支付失败</span></p>                                        </li>')}html+="</ul>",0==number&&$(".bgcolorange").hide(),$(".head .message .list").html(html)},error:function(data){}})},6e4)):clearInterval(terval)}),$rootScope.currentDate=function(){var weekDay="日一二三四五六".charAt((new Date).getDay());return(new Date).toLocaleString()+" 星期"+weekDay},$rootScope.$on("$locationChangeStart",function(){$rootScope.isLoading=!0,$rootScope.message={show:!1}}),$rootScope.$on("$locationChangeSuccess",function(){$rootScope.isLoading=!1}),$rootScope.$watch("message",function(){$rootScope.message&&$rootScope.message.text&&-1!=$rootScope.message.text.indexOf("用户登录已过期，请重新登陆")&&($rootScope.isLogin=!1,$location.path("/login"))})}])}(),window.actionContextPath="action";